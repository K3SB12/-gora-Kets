<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.5, user-scalable=yes">
    <title>üèõÔ∏è √ÅGORA ¬∑ Curso Inteligente desde YouTube</title>
    <!-- Font Awesome 6 -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', 'Palatino', Georgia, serif, system-ui;
        }
        :root {
            --bg: #faf7f2; --sidebar: #2c3e4e; --sidebar-hover: #3e5a6b; --card: #ffffff;
            --text: #2d3e4f; --text-light: #5b6f82; --border: #dcd3c9; --accent: #b68b40;
            --accent-light: #f5e7d3; --success: #2b7a4b; --warning: #b95e0a; --danger: #c13e3e;
            --shadow: 0 12px 30px rgba(99, 70, 40, 0.1); --header-bg: #fff9f0; --input-bg: #ffffff;
            --security-bg: #2c3e4e; --security-text: #f0e9de;
        }
        .dark {
            --bg: #1e2a32; --sidebar: #1a2a35; --card: #2a3a45; --text: #ece5d8;
            --text-light: #cbb99f; --border: #5a4e42; --accent: #d4a95c; --accent-light: #3f4e5d;
            --header-bg: #26343f; --input-bg: #2f4050; --shadow: 0 12px 30px rgba(0, 0, 0, 0.5);
            --security-bg: #1a2a35; --security-text: #e0d6c8;
        }
        body {
            background: var(--bg); color: var(--text); display: flex; min-height: 100vh;
            transition: background 0.2s, color 0.2s;
        }
        .sidebar {
            width: 280px; background: var(--sidebar); color: #f0e9de; padding: 2rem 1rem;
            overflow-y: auto; border-right: 1px solid var(--accent); display: flex;
            flex-direction: column; z-index: 100;
        }
        .sidebar h2 {
            font-weight: 400; font-size: 1.8rem; margin-bottom: 2rem;
            display: flex; align-items: center; gap: 12px;
            border-bottom: 1px solid var(--accent); padding-bottom: 1.2rem;
            font-family: 'Georgia', serif;
        }
        .sidebar h2 i { color: var(--accent); }
        .sidebar nav { display: flex; flex-direction: column; gap: 0.4rem; flex: 1; }
        .sidebar button {
            background: none; border: none; color: #dcd3c9; text-align: left;
            padding: 1rem 1.2rem; font-size: 1rem; border-radius: 14px; cursor: pointer;
            display: flex; align-items: center; gap: 14px; width: 100%;
        }
        .sidebar button i { width: 26px; color: var(--accent); }
        .sidebar button:hover { background: var(--sidebar-hover); color: white; }
        .sidebar button.active { background: var(--accent); color: #1e2a32; font-weight: 500; }
        .sidebar-footer {
            font-size: 0.9rem; color: #b8aa99; padding-top: 2rem;
            border-top: 1px solid var(--accent);
        }
        .main-content { flex: 1; padding: 2rem; overflow-y: auto; max-height: 100vh; }
        .header-bar {
            display: flex; justify-content: space-between; align-items: center;
            margin-bottom: 2rem; background: var(--header-bg); padding: 1rem 2rem;
            border-radius: 50px; box-shadow: var(--shadow); border-left: 8px solid var(--accent);
            flex-wrap: wrap; gap: 1rem;
        }
        .header-bar h1 {
            font-size: 1.8rem; font-family: 'Georgia', serif;
            display: flex; align-items: center; gap: 10px;
        }
        .header-bar h1 i { color: var(--accent); }
        .modo-toggle {
            background: var(--card); border: 1px solid var(--border);
            padding: 0.6rem 1.4rem; border-radius: 40px; cursor: pointer;
            display: flex; align-items: center; gap: 8px;
        }
        .tab-panel { display: none; }
        .tab-panel.active { display: block; }
        .card {
            background: var(--card); border-radius: 32px; padding: 2rem;
            box-shadow: var(--shadow); margin-bottom: 2rem; border: 1px solid var(--border);
        }
        .card h3 {
            margin-bottom: 1.8rem; border-left: 6px solid var(--accent);
            padding-left: 1.2rem; font-size: 1.5rem; font-family: 'Georgia', serif;
        }
        .grid-2 { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 1.8rem; }
        .grid-3 { display: grid; grid-template-columns: repeat(auto-fit, minmax(240px, 1fr)); gap: 1.5rem; }
        .btn {
            background: var(--card); border: 1px solid var(--border);
            padding: 0.7rem 1.5rem; border-radius: 40px; cursor: pointer;
            display: inline-flex; align-items: center; gap: 8px; color: var(--text);
        }
        .btn-primary { background: var(--accent); color: #1e2a32; border: none; }
        .btn-success { background: var(--success); color: white; border: none; }
        .btn-warning { background: var(--warning); color: white; border: none; }
        .security-officer {
            background: var(--security-bg); border-radius: 20px; padding: 1.5rem;
            margin-bottom: 2rem; color: var(--security-text); border-left: 8px solid var(--accent);
        }
        .security-header { display: flex; align-items: center; gap: 1rem; }
        .security-avatar {
            width: 60px; height: 60px; background: var(--accent); border-radius: 50%;
            display: flex; align-items: center; justify-content: center; font-size: 2rem; color: #1e2a32;
        }
        .security-message { margin: 1rem 0; padding: 1rem; background: rgba(255,255,255,0.1); border-radius: 10px; }
        .security-stats { display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 1rem; margin-top: 1rem; }
        .security-stat { background: rgba(255,255,255,0.05); padding: 0.75rem; border-radius: 10px; text-align: center; }
        .step-container { margin: 1.5rem 0; border: 2px solid var(--accent-light); border-radius: 20px; overflow: hidden; }
        .step-header {
            background: var(--accent-light); padding: 1rem 1.5rem; cursor: pointer;
            display: flex; justify-content: space-between; align-items: center;
            font-weight: 600; font-size: 1.1rem; transition: 0.2s;
        }
        .step-header:hover { background: #e8d6b0; }
        .step-header i { transition: transform 0.3s; }
        .step-header.open i { transform: rotate(90deg); }
        .step-content { padding: 1.5rem; background: var(--card); border-top: 1px solid var(--border); }
        .step-section { margin-bottom: 1.5rem; padding: 1rem; background: var(--bg); border-radius: 15px; }
        .step-section h5 { color: var(--accent); margin-bottom: 0.8rem; font-size: 1rem; text-transform: uppercase; }
        .step-checklist { list-style: none; padding: 0; }
        .step-checklist li { padding: 0.5rem 0; display: flex; align-items: center; gap: 0.8rem; border-bottom: 1px dashed var(--border); }
        .step-checklist input[type="checkbox"] { width: 18px; height: 18px; cursor: pointer; accent-color: var(--accent); }
        .step-warning { background: #fff3cd; border-left: 4px solid var(--warning); padding: 1rem; border-radius: 10px; margin: 1rem 0; color: #856404; }
        .code-block { background: #1e293b; color: #e2e8f0; padding: 1rem; border-radius: 10px; font-family: monospace; overflow-x: auto; margin: 1rem 0; }
        .progress-badge { background: var(--accent); color: #1e2a32; padding: 0.2rem 0.8rem; border-radius: 20px; font-size: 0.8rem; font-weight: 600; }
        .toast {
            position: fixed; bottom: 20px; right: 20px; background: var(--accent);
            color: #1e2a32; padding: 1rem 2rem; border-radius: 60px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2); display: none; z-index: 9999;
        }
        @media (max-width: 768px) {
            body { flex-direction: column; }
            .sidebar {
                width: 100%; padding: 1rem; max-height: 80px; overflow: visible;
                flex-direction: row; align-items: center; justify-content: space-between;
                position: sticky; top: 0;
            }
            .sidebar h2 { margin-bottom: 0; border-bottom: none; font-size: 1.2rem; }
            .sidebar nav { flex-direction: row; overflow-x: auto; }
            .sidebar button { padding: 0.5rem 0.8rem; font-size: 0.8rem; white-space: nowrap; }
            .sidebar-footer { display: none; }
            .main-content { padding: 1rem; max-height: none; }
        }
    </style>
</head>
<body>
    <div class="sidebar">
        <h2><i class="fas fa-columns"></i> √ÅGORA</h2>
        <nav id="menuNav">
            <button data-tab="tab1" class="active"><i class="fas fa-youtube"></i> √Ågora¬∑Video</button>
            <button data-tab="tab2"><i class="fas fa-landmark"></i> Arquitectura</button>
            <button data-tab="tab3"><i class="fas fa-microchip"></i> Modelos IA</button>
            <button data-tab="tab4"><i class="fas fa-dollar-sign"></i> Casos √Åureos</button>
            <button data-tab="tab5"><i class="fas fa-scroll"></i> SPEC</button>
            <button data-tab="tab6"><i class="fas fa-terminal"></i> Gemini</button>
            <button data-tab="tab7"><i class="fas fa-shield-alt"></i> Seguridad</button>
            <button data-tab="tab8"><i class="fas fa-book"></i> Mi √Ågora</button>
        </nav>
        <div class="sidebar-footer"><i class="fas fa-leaf"></i> Siempre gratuito ¬∑ Sabidur√≠a colectiva</div>
    </div>

    <div class="main-content">
        <div class="header-bar">
            <h1><i class="fas fa-columns"></i> √ÅGORA ¬∑ Curso Inteligente desde YouTube</h1>
            <div class="modo-toggle" id="toggleModo"><i class="fas fa-moon"></i> <span>Claroscuro</span></div>
        </div>

        <!-- ========== PANEL 1: √ÅGORA¬∑VIDEO CON YOUTUBE API REAL ========== -->
        <div id="tab1" class="tab-panel active">
            <div class="card">
                <h3><i class="fas fa-youtube" style="color: var(--accent);"></i> √Ågora¬∑Video con YouTube API</h3>
                <p>Pega cualquier enlace de YouTube y obtendr√°s el t√≠tulo real, descripci√≥n y un curso generado con IA paso a paso.</p>
                
                <div style="background: linear-gradient(135deg, #b68b40, #8a6a30); padding: 2rem; border-radius: 20px; margin: 2rem 0; color: white;">
                    <label style="color: white;">üîó Enlace del video</label>
                    <input type="url" id="youtubeUrl" placeholder="https://youtube.com/watch?v=..." style="background: white; color: black;">
                    <button class="btn" id="generarCursoBtn" style="background: #1e2a32; color: white; margin-top: 1rem;">
                        <i class="fas fa-magic"></i> Obtener datos y generar curso
                    </button>
                </div>

                <div id="loading" style="display: none; text-align: center; padding: 2rem;">
                    <i class="fas fa-spinner fa-spin" style="font-size: 2rem; color: var(--accent);"></i>
                    <p>Obteniendo informaci√≥n del video...</p>
                </div>

                <div id="errorMsg" style="display: none; background: #fee2e2; color: #991b1b; padding: 1rem; border-radius: 10px; margin: 1rem 0;"></div>

                <div id="resultadoCurso" style="display: none;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                        <h4 id="videoTitulo" style="color: var(--accent); font-family: Georgia;"></h4>
                        <span class="progress-badge" id="cursoProgreso">0/5 completado</span>
                    </div>
                    
                    <div style="position: relative; padding-bottom: 56.25%; margin: 1rem 0;">
                        <iframe id="videoIframe" style="position: absolute; top:0; left:0; width:100%; height:100%; border-radius:15px;" frameborder="0" allowfullscreen></iframe>
                    </div>

                    <div id="videoDescripcion" style="background: var(--bg); padding: 1rem; border-radius: 15px; margin: 1rem 0;"></div>
                    
                    <div id="pasosContainer"></div>
                    
                    <button class="btn btn-success" onclick="guardarCurso()" style="margin-top: 1rem; width: 100%;">
                        <i class="fas fa-save"></i> Guardar curso en Mi √Ågora
                    </button>
                </div>
            </div>
        </div>

        <!-- ========== PANEL 2: ARQUITECTURA ========== -->
        <div id="tab2" class="tab-panel">
            <div class="card">
                <h3><i class="fas fa-landmark"></i> Arquitectura Profesional</h3>
                <div class="grid-2">
                    <div>
                        <h4>Plantilla de Contexto</h4>
                        <div class="code-block">
// ROL: "Eres arquitecta senior"
// CONTEXTO: "App que escalar√° a 1M usuarios"
// RESTRICCIONES: "Offline-first"
// EJEMPLOS: "Como Uber, pero para..."
                        </div>
                        <button class="btn btn-primary" onclick="descargarPlantilla()">Descargar plantilla</button>
                    </div>
                    <div>
                        <h4>Video Recomendado</h4>
                        <div style="position: relative; padding-bottom: 56.25%;">
                            <iframe src="https://www.youtube.com/embed/8BZ2AlerW9c" style="position: absolute; top:0; left:0; width:100%; height:100%; border-radius:15px;" frameborder="0" allowfullscreen></iframe>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ========== PANEL 3: MODELOS IA ========== -->
        <div id="tab3" class="tab-panel">
            <div class="card">
                <h3>ü§ñ Comparativa Modelos IA 2026</h3>
                <table class="step-section" style="width:100%;">
                    <tr><th>Modelo</th><th>Contexto</th><th>Precio</th></tr>
                    <tr><td>Claude 4.5</td><td>500k tokens</td><td>$20/mes</td></tr>
                    <tr><td>Gemini 3.1 Pro</td><td>2M tokens</td><td>$22/mes</td></tr>
                    <tr><td>DeepSeek V3</td><td>128k tokens</td><td class="badge-safe">GRATIS</td></tr>
                </table>
            </div>
        </div>

        <!-- ========== PANEL 4: CASOS √ÅUREOS ========== -->
        <div id="tab4" class="tab-panel">
            <div class="card">
                <h3><i class="fas fa-dollar-sign"></i> Casos de √âxito</h3>
                <div class="grid-3">
                    <div class="step-section"><h4>GoodBarber</h4><p>+$10M en ventas</p><a href="https://es.goodbarber.com" target="_blank">Ver ‚Üí</a></div>
                    <div class="step-section"><h4>Adalo</h4><p>+3M de apps</p><a href="https://adalo.com" target="_blank">Ver ‚Üí</a></div>
                    <div class="step-section"><h4>Bubble</h4><p>Startups Series A</p><a href="https://bubble.io/showcase" target="_blank">Ver ‚Üí</a></div>
                </div>
            </div>
        </div>

        <!-- ========== PANEL 5: SPEC T√âCNICO ========== -->
        <div id="tab5" class="tab-panel">
            <div class="card">
                <h3><i class="fas fa-scroll"></i> SPEC T√©cnico</h3>
                <div class="code-block">
# SPEC
## 1. Visi√≥n
## 2. Arquitectura
## 3. Flujos
## 4. Datos
## 5. Seguridad
                </div>
                <button class="btn btn-primary" onclick="descargarSpec()">Descargar SPEC.md</button>
            </div>
        </div>

        <!-- ========== PANEL 6: GEMINI CLI ========== -->
        <div id="tab6" class="tab-panel">
            <div class="card">
                <h3><i class="fas fa-terminal"></i> Gemini CLI / Plan Mode</h3>
                <div class="code-block">
npm install -g @google/gemini-cli
/plan  # Activar Plan Mode
                </div>
            </div>
        </div>

        <!-- ========== PANEL 7: OFICIAL DE SEGURIDAD ========== -->
        <div id="tab7" class="tab-panel">
            <div class="card">
                <h3><i class="fas fa-shield-alt"></i> √Ågora¬∑Seguridad</h3>
                <div class="security-officer" id="securityOfficer">
                    <div class="security-header">
                        <div class="security-avatar"><i class="fas fa-shield-alt"></i></div>
                        <span class="badge-safe">üõ°Ô∏è MODO SEGURO</span>
                    </div>
                    <div class="security-message" id="securityMessage">Todo gratuito, t√∫ decides si gastar.</div>
                    <div class="security-stats">
                        <div class="security-stat">üü¢ <span id="safeDecisions">0</span> seguras</div>
                        <div class="security-stat">üü° <span id="warnings">0</span> alertas</div>
                        <div class="security-stat">üî¥ <span id="risksAvoided">0</span> riesgos</div>
                        <div class="security-stat">üí∞ $<span id="costSavings">0</span> ahorrados</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ========== PANEL 8: MI √ÅGORA ========== -->
        <div id="tab8" class="tab-panel">
            <div class="card">
                <h3><i class="fas fa-book"></i> Mis Cursos Guardados</h3>
                <div id="cursosGuardados"></div>
            </div>
        </div>

        <div class="toast" id="toastMsg">‚úÖ Hecho en √Ågora</div>
    </div>

    <script>
        // ============================================================
        // CONFIGURACI√ìN - PEGA TU API KEY AQU√ç
        // ============================================================
        const API_KEY = 'AQUI_PEGA_TU_API_KEY'; // <-- REEMPLAZA ESTO CON TU CLAVE REAL
        
        // Verificaci√≥n amigable
        if (API_KEY === 'AQUI_PEGA_TU_API_KEY') {
            alert('üîë Recuerda pegar tu API Key de YouTube en el c√≥digo (busca "AQUI_PEGA_TU_API_KEY")');
        }

        // ============================================================
        // OFICIAL DE SEGURIDAD
        // ============================================================
        const SecurityOfficer = {
            stats: { safeDecisions:0, warnings:0, risksAvoided:0, costSavings:0 },
            logSafeDecision(msg) { this.stats.safeDecisions++; this.updateUI(); this.showMessage(`‚úÖ ${msg}`); },
            logWarning(msg) { this.stats.warnings++; this.updateUI(); this.showMessage(`‚ö†Ô∏è ${msg}`); },
            logRiskAvoided(msg) { this.stats.risksAvoided++; this.stats.costSavings+=200; this.updateUI(); this.showMessage(`üõ°Ô∏è ${msg}`); },
            showMessage(msg) { document.getElementById('securityMessage').innerHTML = msg; },
            updateUI() {
                document.getElementById('safeDecisions').innerText = this.stats.safeDecisions;
                document.getElementById('warnings').innerText = this.stats.warnings;
                document.getElementById('risksAvoided').innerText = this.stats.risksAvoided;
                document.getElementById('costSavings').innerText = this.stats.costSavings;
            }
        };
        SecurityOfficer.updateUI();

        // ============================================================
        // FUNCI√ìN PARA OBTENER DATOS DE YOUTUBE (VIDEOS.LIST)
        // ============================================================
        async function obtenerInfoVideo(videoId) {
            const url = `https://www.googleapis.com/youtube/v3/videos?part=snippet&id=${videoId}&key=${API_KEY}`;
            
            try {
                const response = await fetch(url);
                const data = await response.json();
                
                if (data.error) {
                    throw new Error(data.error.message);
                }
                
                if (data.items && data.items.length > 0) {
                    return data.items[0].snippet;
                } else {
                    throw new Error('Video no encontrado');
                }
            } catch (error) {
                console.error('Error al obtener video:', error);
                throw error;
            }
        }

        // ============================================================
        // GENERADOR DE CURSOS (con datos reales de YouTube)
        // ============================================================
        let cursoActual = null;
        let progresoPasos = [];

        document.getElementById('generarCursoBtn').addEventListener('click', async ()=>{
            const url = document.getElementById('youtubeUrl').value;
            if(!url) { alert('Pega un enlace de YouTube'); return; }
            
            // Extraer ID del video
            let videoId = '';
            const regExp = /^.*(youtu.be\/|v\/|u\/\w\/|embed\/|watch\?v=|\&v=)([^#\&\?]*).*/;
            const match = url.match(regExp);
            if (match && match[2].length === 11) videoId = match[2];
            else { alert('URL no v√°lida'); return; }

            // Mostrar loading
            document.getElementById('loading').style.display = 'block';
            document.getElementById('resultadoCurso').style.display = 'none';
            document.getElementById('errorMsg').style.display = 'none';

            try {
                // Obtener datos reales de YouTube
                SecurityOfficer.logSafeDecision('Llamada a YouTube API (costo: 1 unidad)');
                const snippet = await obtenerInfoVideo(videoId);
                
                // T√≠tulo real
                const titulo = snippet.title;
                document.getElementById('videoTitulo').innerText = titulo;
                document.getElementById('videoIframe').src = `https://www.youtube.com/embed/${videoId}`;
                
                // Descripci√≥n real (limitada para no saturar)
                const descripcion = snippet.description.substring(0, 300) + (snippet.description.length > 300 ? '...' : '');
                document.getElementById('videoDescripcion').innerHTML = `<strong>üìù Descripci√≥n:</strong> ${descripcion}`;

                // Generar pasos basados en palabras clave de la descripci√≥n/t√≠tulo
                const textoCompleto = (titulo + ' ' + snippet.description).toLowerCase();
                
                // Detectar tema para personalizar pasos
                let pasosGenerados;
                if (textoCompleto.includes('firebase') || textoCompleto.includes('base de datos')) {
                    pasosGenerados = pasosFirebase;
                } else if (textoCompleto.includes('react') || textoCompleto.includes('frontend')) {
                    pasosGenerados = pasosReact;
                } else if (textoCompleto.includes('api') || textoCompleto.includes('backend')) {
                    pasosGenerados = pasosAPI;
                } else {
                    pasosGenerados = pasosArquitectura; // Por defecto
                }

                cursoActual = { pasos: pasosGenerados };
                progresoPasos = new Array(pasosGenerados.length).fill(false);
                
                renderizarPasos(pasosGenerados);
                document.getElementById('resultadoCurso').style.display = 'block';
                actualizarProgreso();
                
                SecurityOfficer.logSafeDecision('Curso generado con datos reales de YouTube');
                
            } catch (error) {
                document.getElementById('errorMsg').style.display = 'block';
                document.getElementById('errorMsg').innerHTML = `‚ùå Error: ${error.message}. Verifica tu API Key y que el video exista.`;
                SecurityOfficer.logWarning('Error al obtener datos de YouTube');
            } finally {
                document.getElementById('loading').style.display = 'none';
            }
        });

        // ============================================================
        // BIBLIOTECA DE PASOS SEG√öN TEMAS
        // ============================================================
        const pasosArquitectura = [
            {
                titulo: "An√°lisis de Contexto",
                herramientas: ["Miro o pizarra", "Documentaci√≥n", "Entrevistas"],
                queHacer: ["Identificar actores", "Definir alcance", "Listar restricciones"],
                cuidados: ["No saltarse este paso", "Involucrar a stakeholders"],
                ejemplo: "Para una app de reservas, los actores son usuarios y due√±os de locales."
            },
            {
                titulo: "Dise√±o de Arquitectura",
                herramientas: ["Draw.io", "Lucidchart"],
                queHacer: ["Diagrama de componentes", "Elegir stack tecnol√≥gico"],
                cuidados: ["Evitar sobreingenier√≠a"],
                ejemplo: "Frontend: React, Backend: Firebase, Base de datos: Firestore"
            }
        ];

        const pasosFirebase = [
            {
                titulo: "Configurar Firebase",
                herramientas: ["Cuenta Google", "Firebase Console"],
                queHacer: ["Crear proyecto", "Registrar app", "Copiar config"],
                cuidados: ["NUNCA subir credenciales a GitHub", "Activar alertas de presupuesto"],
                ejemplo: "import { initializeApp } from 'firebase/app';"
            },
            {
                titulo: "Autenticaci√≥n",
                herramientas: ["Firebase Auth"],
                queHacer: ["Habilitar email/password", "Configurar reglas"],
                cuidados: ["Verificar emails", "Rate limiting"],
                ejemplo: "createUserWithEmailAndPassword(auth, email, password)"
            }
        ];

        const pasosReact = [
            {
                titulo: "Crear proyecto React",
                herramientas: ["Node.js", "npm/yarn"],
                queHacer: ["npx create-react-app mi-app", "Estructurar carpetas"],
                cuidados: ["Mantener versi√≥n de Node actualizada"],
                ejemplo: "npx create-react-app mi-app --template typescript"
            }
        ];

        const pasosAPI = [
            {
                titulo: "Dise√±ar endpoints",
                herramientas: ["Postman", "Swagger"],
                queHacer: ["Definir rutas REST", "Estructurar JSON"],
                cuidados: ["Versionar API (/v1/...)", "Documentar"],
                ejemplo: "GET /api/v1/usuarios"
            }
        ];

        function renderizarPasos(pasos) {
            const container = document.getElementById('pasosContainer');
            let html = '';
            
            pasos.forEach((paso, index) => {
                const completado = progresoPasos[index] ? 'open' : '';
                const checkIcon = progresoPasos[index] ? 'fa-check-circle' : 'fa-circle';
                
                html += `
                    <div class="step-container">
                        <div class="step-header" onclick="togglePaso(${index})">
                            <span><i class="fas ${checkIcon}" style="color: ${progresoPasos[index] ? 'var(--success)' : 'var(--accent)'};"></i> Paso ${index+1}: ${paso.titulo}</span>
                            <i class="fas fa-chevron-right"></i>
                        </div>
                        <div class="step-content" id="paso-${index}" style="display: none;">
                            
                            <div class="step-section">
                                <h5><i class="fas fa-tools"></i> HERRAMIENTAS</h5>
                                <ul class="step-checklist">
                                    ${paso.herramientas.map(h => `<li><input type="checkbox" onchange="marcarSubtarea(${index}, this)"> ${h}</li>`).join('')}
                                </ul>
                            </div>
                            
                            <div class="step-section">
                                <h5><i class="fas fa-list-check"></i> QU√â HACER</h5>
                                <ul class="step-checklist">
                                    ${paso.queHacer.map(q => `<li><input type="checkbox" onchange="marcarSubtarea(${index}, this)"> ${q}</li>`).join('')}
                                </ul>
                            </div>
                            
                            <div class="step-warning">
                                <h5><i class="fas fa-exclamation-triangle"></i> CUIDADOS</h5>
                                <ul>${paso.cuidados.map(c => `<li>${c}</li>`).join('')}</ul>
                            </div>
                            
                            <div class="step-section">
                                <h5><i class="fas fa-flask"></i> EJEMPLO</h5>
                                <p>${paso.ejemplo}</p>
                            </div>
                            
                            <button class="btn btn-sm" onclick="marcarPasoCompletado(${index})">
                                <i class="fas fa-check-circle"></i> Marcar paso completado
                            </button>
                        </div>
                    </div>
                `;
            });
            
            container.innerHTML = html;
        }

        window.togglePaso = (index) => {
            const content = document.getElementById(`paso-${index}`);
            const header = content.previousElementSibling;
            if (content.style.display === 'none') {
                content.style.display = 'block';
                header.classList.add('open');
            } else {
                content.style.display = 'none';
                header.classList.remove('open');
            }
        };

        window.marcarPasoCompletado = (index) => {
            progresoPasos[index] = true;
            renderizarPasos(cursoActual.pasos);
            actualizarProgreso();
            document.getElementById(`paso-${index}`).style.display = 'none';
            SecurityOfficer.logSafeDecision(`Paso ${index+1} completado`);
        };

        function actualizarProgreso() {
            const completados = progresoPasos.filter(p => p).length;
            document.getElementById('cursoProgreso').innerText = `${completados}/${progresoPasos.length} completado`;
        }

        window.guardarCurso = function() {
            if(!cursoActual) return;
            let guardados = JSON.parse(localStorage.getItem('misCursos')) || [];
            guardados.push({
                titulo: document.getElementById('videoTitulo').innerText,
                videoId: document.getElementById('videoIframe').src.split('/').pop().split('?')[0],
                fecha: new Date().toLocaleDateString(),
                progreso: progresoPasos,
                pasos: cursoActual.pasos
            });
            localStorage.setItem('misCursos', JSON.stringify(guardados));
            mostrarCursosGuardados();
            toast('üìö Curso guardado');
        };

        function mostrarCursosGuardados() {
            const div = document.getElementById('cursosGuardados');
            const guardados = JSON.parse(localStorage.getItem('misCursos')) || [];
            if(guardados.length === 0) { 
                div.innerHTML = '<p>Tu √°gora personal est√° vac√≠a.</p>'; 
                return; 
            }
            let html = '';
            guardados.forEach((c, i) => {
                html += `<div style="padding:1rem; border-bottom:1px solid var(--border);">
                    <strong>${c.titulo}</strong> (${c.fecha})<br>
                    <iframe src="https://www.youtube.com/embed/${c.videoId}" style="width:100%; height:200px; border-radius:15px; margin-top:0.5rem;" frameborder="0" allowfullscreen></iframe>
                    <p>Progreso: ${c.progreso?.filter(p=>p).length || 0}/${c.pasos?.length || 0} pasos</p>
                </div>`;
            });
            div.innerHTML = html;
        }

        // ============================================================
        // FUNCIONES AUXILIARES
        // ============================================================
        function toast(msg) { 
            let t = document.getElementById('toastMsg'); 
            t.style.display = 'block'; 
            t.innerText = msg; 
            setTimeout(() => t.style.display = 'none', 2000); 
        }

        document.getElementById('toggleModo').addEventListener('click', ()=> document.body.classList.toggle('dark'));

        document.querySelectorAll('#menuNav button').forEach(b => {
            b.addEventListener('click', (e) => {
                document.querySelectorAll('#menuNav button').forEach(bb => bb.classList.remove('active'));
                b.classList.add('active');
                document.querySelectorAll('.tab-panel').forEach(p => p.classList.remove('active'));
                document.getElementById(b.dataset.tab).classList.add('active');
                if(b.dataset.tab === 'tab8') mostrarCursosGuardados();
            });
        });

        window.descargarPlantilla = function() {
            const plantilla = `ROL: "Arquitecta senior"\nCONTEXTO: "App para ..."\nRESTRICCIONES: "...";`;
            const blob = new Blob([plantilla], {type:'text/plain'});
            const a = document.createElement('a'); a.href = URL.createObjectURL(blob); a.download = 'plantilla-contexto.txt'; a.click();
        };

        window.descargarSpec = function() {
            const spec = `# SPEC T√âCNICO\n## Visi√≥n\n## Arquitectura\n## Flujos`;
            const blob = new Blob([spec], {type:'text/markdown'});
            const a = document.createElement('a'); a.href = URL.createObjectURL(blob); a.download = 'spec.md'; a.click();
        };

        // Inicializar
        mostrarCursosGuardados();
    </script>
</body>
</html>
