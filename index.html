<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.5, user-scalable=yes">
    <title>üèõÔ∏è √ÅGORA ¬∑ Tu compa√±ero de aprendizaje</title>
    <!-- Font Awesome 6 -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', 'Palatino', Georgia, serif, system-ui;
        }
        :root {
            --bg: #faf7f2; --sidebar: #2c3e4e; --sidebar-hover: #3e5a6b; --card: #ffffff;
            --text: #2d3e4f; --text-light: #5b6f82; --border: #dcd3c9; --accent: #b68b40;
            --accent-light: #f5e7d3; --success: #2b7a4b; --warning: #b95e0a; --danger: #c13e3e;
            --shadow: 0 12px 30px rgba(99, 70, 40, 0.1); --header-bg: #fff9f0; --input-bg: #ffffff;
            --security-bg: #2c3e4e; --security-text: #f0e9de;
        }
        .dark {
            --bg: #1e2a32; --sidebar: #1a2a35; --card: #2a3a45; --text: #ece5d8;
            --text-light: #cbb99f; --border: #5a4e42; --accent: #d4a95c; --accent-light: #3f4e5d;
            --header-bg: #26343f; --input-bg: #2f4050; --shadow: 0 12px 30px rgba(0, 0, 0, 0.5);
            --security-bg: #1a2a35; --security-text: #e0d6c8;
        }
        body {
            background: var(--bg); color: var(--text); display: flex; min-height: 100vh;
            transition: background 0.2s, color 0.2s;
        }
        .sidebar {
            width: 280px; background: var(--sidebar); color: #f0e9de; padding: 2rem 1rem;
            overflow-y: auto; border-right: 1px solid var(--accent); display: flex;
            flex-direction: column; z-index: 100;
        }
        .sidebar h2 {
            font-weight: 400; font-size: 1.8rem; margin-bottom: 2rem;
            display: flex; align-items: center; gap: 12px;
            border-bottom: 1px solid var(--accent); padding-bottom: 1.2rem;
            font-family: 'Georgia', serif;
        }
        .sidebar h2 i { color: var(--accent); }
        .sidebar nav { display: flex; flex-direction: column; gap: 0.4rem; flex: 1; }
        .sidebar button {
            background: none; border: none; color: #dcd3c9; text-align: left;
            padding: 1rem 1.2rem; font-size: 1rem; border-radius: 14px; cursor: pointer;
            display: flex; align-items: center; gap: 14px; width: 100%;
        }
        .sidebar button i { width: 26px; color: var(--accent); }
        .sidebar button:hover { background: var(--sidebar-hover); color: white; }
        .sidebar button.active { background: var(--accent); color: #1e2a32; font-weight: 500; }
        .sidebar-footer {
            font-size: 0.9rem; color: #b8aa99; padding-top: 2rem;
            border-top: 1px solid var(--accent);
        }
        .main-content {
            flex: 1; padding: 2rem; overflow-y: auto; max-height: 100vh;
        }
        .header-bar {
            display: flex; justify-content: space-between; align-items: center;
            margin-bottom: 2rem; background: var(--header-bg); padding: 1rem 2rem;
            border-radius: 50px; box-shadow: var(--shadow); border-left: 8px solid var(--accent);
            flex-wrap: wrap; gap: 1rem;
        }
        .header-bar h1 {
            font-size: 1.8rem; font-family: 'Georgia', serif;
            display: flex; align-items: center; gap: 10px;
        }
        .header-bar h1 i { color: var(--accent); }
        .modo-toggle {
            background: var(--card); border: 1px solid var(--border);
            padding: 0.6rem 1.4rem; border-radius: 40px; cursor: pointer;
            display: flex; align-items: center; gap: 8px;
        }
        .tab-panel { display: none; }
        .tab-panel.active { display: block; }
        .card {
            background: var(--card); border-radius: 32px; padding: 2rem;
            box-shadow: var(--shadow); margin-bottom: 2rem; border: 1px solid var(--border);
        }
        .card h3 {
            margin-bottom: 1.8rem; border-left: 6px solid var(--accent);
            padding-left: 1.2rem; font-size: 1.5rem; font-family: 'Georgia', serif;
        }
        .grid-2 { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 1.8rem; }
        .grid-3 { display: grid; grid-template-columns: repeat(auto-fit, minmax(240px, 1fr)); gap: 1.5rem; }
        .btn {
            background: var(--card); border: 1px solid var(--border);
            padding: 0.7rem 1.5rem; border-radius: 40px; cursor: pointer;
            display: inline-flex; align-items: center; gap: 8px; color: var(--text);
            font-size: 0.95rem;
        }
        .btn-primary { background: var(--accent); color: #1e2a32; border: none; }
        .btn-primary:hover { background: #c9a04b; }
        .btn-success { background: var(--success); color: white; border: none; }
        .btn-warning { background: var(--warning); color: white; border: none; }
        .btn-danger { background: var(--danger); color: white; border: none; }
        .btn-sm { padding: 0.5rem 1.2rem; font-size: 0.85rem; }
        .badge {
            padding: 0.3rem 0.8rem; border-radius: 30px; font-size: 0.75rem;
            background: var(--accent-light); color: var(--accent); font-weight: 600;
        }
        .badge-safe { background: #10b981; color: white; }
        .fila-acciones i { margin: 0 6px; cursor: pointer; opacity: 0.7; font-size: 1rem; }
        .fila-acciones i:hover { opacity: 1; color: var(--accent); }
        .barra-acciones { display: flex; gap: 10px; flex-wrap: wrap; margin: 1.5rem 0; }
        .toast {
            position: fixed; bottom: 20px; right: 20px; background: var(--accent);
            color: #1e2a32; padding: 1rem 2rem; border-radius: 60px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2); display: none; z-index: 9999;
            font-weight: 500;
        }
        .security-officer {
            background: var(--security-bg); border-radius: 20px; padding: 1.5rem;
            margin-bottom: 2rem; color: var(--security-text); border-left: 8px solid var(--accent);
        }
        .security-header { display: flex; align-items: center; gap: 1rem; margin-bottom: 1rem; }
        .security-avatar {
            width: 60px; height: 60px; background: var(--accent); border-radius: 50%;
            display: flex; align-items: center; justify-content: center; font-size: 2rem; color: #1e2a32;
        }
        .security-message { margin: 1rem 0; padding: 1rem; background: rgba(255,255,255,0.1); border-radius: 10px; }
        .security-stats { display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 1rem; margin-top: 1rem; }
        .security-stat { background: rgba(255,255,255,0.05); padding: 0.75rem; border-radius: 10px; text-align: center; }

        /* Estilos para categor√≠as */
        .categoria-container {
            background: var(--bg); border-radius: 20px; padding: 1rem; margin-bottom: 1rem;
        }
        .categoria-header {
            display: flex; justify-content: space-between; align-items: center;
            padding: 0.5rem; cursor: pointer; border-bottom: 1px solid var(--border);
        }
        .categoria-header h4 { display: flex; align-items: center; gap: 0.5rem; }
        .categoria-content { padding: 1rem 0; }
        .enlace-item {
            display: flex; justify-content: space-between; align-items: center;
            padding: 0.5rem; border-bottom: 1px dashed var(--border);
        }
        .enlace-item:last-child { border-bottom: none; }

        /* Estilos para historial */
        .historial-dia {
            margin-bottom: 1.5rem; padding: 1rem; background: var(--bg); border-radius: 15px;
        }
        .historial-fecha {
            font-weight: 600; color: var(--accent); margin-bottom: 0.5rem;
        }

        /* Estilos para bit√°cora */
        .bitacora-entrada {
            background: var(--bg); border-radius: 15px; padding: 1rem; margin-bottom: 1rem;
        }
        .bitacora-tags span {
            background: var(--accent-light); padding: 0.2rem 0.5rem; border-radius: 15px;
            font-size: 0.8rem; margin-right: 0.3rem;
        }

        /* Responsive m√≥vil */
        @media (max-width: 768px) {
            body { flex-direction: column; }
            .sidebar {
                width: 100%; padding: 1rem; max-height: 80px; overflow: visible;
                flex-direction: row; align-items: center; justify-content: space-between;
                position: sticky; top: 0; z-index: 1000;
            }
            .sidebar h2 { margin-bottom: 0; border-bottom: none; padding-bottom: 0; font-size: 1.2rem; }
            .sidebar nav { flex-direction: row; overflow-x: auto; gap: 0.2rem; }
            .sidebar button { padding: 0.5rem 0.8rem; font-size: 0.8rem; white-space: nowrap; }
            .sidebar-footer { display: none; }
            .main-content { padding: 1rem; max-height: none; }
            .header-bar { flex-direction: column; align-items: flex-start; padding: 1rem; }
            .grid-2, .grid-3 { grid-template-columns: 1fr; }
            .barra-acciones { flex-direction: column; align-items: stretch; }
            .btn { justify-content: center; }
        }
    </style>
</head>
<body>
    <div class="sidebar">
        <h2><i class="fas fa-columns"></i> √ÅGORA</h2>
        <nav id="menuNav">
            <button data-tab="tab1" class="active"><i class="fas fa-youtube"></i> √Ågora¬∑Video</button>
            <button data-tab="tab2"><i class="fas fa-folder-tree"></i> Categor√≠as</button>
            <button data-tab="tab3"><i class="fas fa-history"></i> Historial</button>
            <button data-tab="tab4"><i class="fas fa-book-open"></i> Bit√°cora</button>
            <button data-tab="tab5"><i class="fas fa-chart-line"></i> Progreso</button>
            <button data-tab="tab6"><i class="fas fa-shield-alt"></i> Seguridad</button>
            <button data-tab="tab7"><i class="fas fa-info-circle"></i> Gu√≠as</button>
        </nav>
        <div class="sidebar-footer"><i class="fas fa-leaf"></i> Siempre gratuito ¬∑ Tu compa√±ero de aprendizaje</div>
    </div>

    <div class="main-content">
        <div class="header-bar">
            <h1><i class="fas fa-columns"></i> √ÅGORA ¬∑ Tu compa√±ero de aprendizaje</h1>
            <div class="modo-toggle" id="toggleModo"><i class="fas fa-moon"></i> <span>Claroscuro</span></div>
        </div>

        <!-- ========== PANEL 1: √ÅGORA¬∑VIDEO ========== -->
        <div id="tab1" class="tab-panel active">
            <div class="card">
                <h3><i class="fas fa-youtube"></i> √Ågora¬∑Video</h3>
                <p>Pega cualquier enlace de YouTube y obt√©n recomendaciones personalizadas.</p>
                
                <div style="background: linear-gradient(135deg, #b68b40, #8a6a30); padding: 2rem; border-radius: 20px; margin: 2rem 0;">
                    <label style="color: white;">üîó Enlace del video</label>
                    <input type="url" id="youtubeUrl" placeholder="https://youtube.com/watch?v=..." style="background: white; width:100%;">
                    <button class="btn" id="analizarVideoBtn" style="background: #1e2a32; color: white; margin-top: 1rem; width:100%;">
                        <i class="fas fa-magic"></i> Analizar video
                    </button>
                </div>

                <div id="analisisResultado" style="display: none;">
                    <div style="background: var(--accent-light); padding: 1.5rem; border-radius: 15px; margin-bottom: 1.5rem;">
                        <h4>üìä An√°lisis del video</h4>
                        <p><strong>T√≠tulo:</strong> <span id="videoTitulo"></span></p>
                        <p><strong>Tema detectado:</strong> <span id="videoTema"></span></p>
                        <p><strong>Nivel estimado:</strong> <span id="videoNivel"></span></p>
                        <p><strong>Etiquetas sugeridas:</strong> <span id="videoEtiquetas"></span></p>
                    </div>

                    <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 1rem; margin-bottom: 1.5rem;">
                        <div style="background: var(--bg); padding: 1rem; border-radius: 15px; text-align: center;">
                            <h5>üéØ Recomendaci√≥n principal</h5>
                            <p id="recomendacionPrincipal"></p>
                            <button class="btn btn-sm btn-primary" id="abrirRecomendacionBtn">Abrir herramienta</button>
                        </div>
                        <div style="background: var(--bg); padding: 1rem; border-radius: 15px; text-align: center;">
                            <h5>üìã Alternativas</h5>
                            <p id="recomendacionAlternativa"></p>
                        </div>
                    </div>

                    <div style="background: var(--bg); padding: 1.5rem; border-radius: 15px;">
                        <h4>üìã Gu√≠a paso a paso</h4>
                        <div id="guiaPasos"></div>
                        <button class="btn btn-success btn-sm" id="guardarProgresoBtn" style="margin-top: 1rem;">Guardar progreso</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- ========== PANEL 2: CATEGOR√çAS ========== -->
        <div id="tab2" class="tab-panel">
            <div class="card">
                <h3><i class="fas fa-folder-tree"></i> Mis categor√≠as</h3>
                <div class="barra-acciones">
                    <button class="btn btn-primary" id="nuevaCategoriaBtn"><i class="fas fa-plus"></i> Nueva categor√≠a</button>
                </div>
                <div id="categoriasContainer"></div>
            </div>
        </div>

        <!-- ========== PANEL 3: HISTORIAL ========== -->
        <div id="tab3" class="tab-panel">
            <div class="card">
                <h3><i class="fas fa-history"></i> Historial de aprendizaje</h3>
                <div id="historialContainer"></div>
            </div>
        </div>

        <!-- ========== PANEL 4: BIT√ÅCORA ========== -->
        <div id="tab4" class="tab-panel">
            <div class="card">
                <h3><i class="fas fa-book-open"></i> Mi bit√°cora</h3>
                <div class="barra-acciones">
                    <button class="btn btn-primary" id="nuevaEntradaBitacoraBtn"><i class="fas fa-plus"></i> Nueva entrada</button>
                </div>
                <div id="bitacoraContainer"></div>
            </div>
        </div>

        <!-- ========== PANEL 5: PROGRESO ========== -->
        <div id="tab5" class="tab-panel">
            <div class="card">
                <h3><i class="fas fa-chart-line"></i> Mi progreso</h3>
                <div class="security-officer" style="margin-bottom: 2rem;">
                    <div class="security-stats">
                        <div class="security-stat">üìä <span id="totalVideos">0</span> videos</div>
                        <div class="security-stat">üìù <span id="totalNotas">0</span> notas</div>
                        <div class="security-stat">üî• <span id="rachaActual">0</span> d√≠as seguidos</div>
                        <div class="security-stat">üèÜ <span id="mejorRacha">0</span> mejor racha</div>
                    </div>
                </div>
                <div id="progresoDetalle"></div>
            </div>
        </div>

        <!-- ========== PANEL 6: SEGURIDAD ========== -->
        <div id="tab6" class="tab-panel">
            <div class="card">
                <h3><i class="fas fa-shield-alt"></i> Oficial de Seguridad</h3>
                <div class="security-officer" id="securityOfficer">
                    <div class="security-header">
                        <div class="security-avatar"><i class="fas fa-shield-alt"></i></div>
                        <span class="badge-safe">üõ°Ô∏è MODO SEGURO</span>
                    </div>
                    <div class="security-message" id="securityMessage">
                        ‚úÖ Sin APIs externas ¬∑ ‚úÖ Sin costos ¬∑ ‚úÖ Sin riesgos
                    </div>
                    <div class="security-stats">
                        <div class="security-stat">üü¢ <span id="safeDecisions">0</span> seguras</div>
                        <div class="security-stat">üü° <span id="warnings">0</span> alertas</div>
                        <div class="security-stat">üî¥ <span id="risksAvoided">0</span> riesgos</div>
                        <div class="security-stat">üí∞ $<span id="costSavings">0</span> ahorrados</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ========== PANEL 7: GU√çAS ========== -->
        <div id="tab7" class="tab-panel">
            <div class="card">
                <h3><i class="fas fa-info-circle"></i> Gu√≠as de herramientas</h3>
                <div class="grid-3">
                    <div class="step-section">
                        <h4>üéØ Miyagi Labs</h4>
                        <p>Genera cursos completos con quizzes y feedback IA</p>
                        <a href="https://miyagilabs.ai" target="_blank" class="btn btn-sm">Visitar</a>
                    </div>
                    <div class="step-section">
                        <h4>üìù Ainee</h4>
                        <p>Notas, mapas mentales, flashcards y podcasts</p>
                        <a href="https://ainee.com" target="_blank" class="btn btn-sm">Visitar</a>
                    </div>
                    <div class="step-section">
                        <h4>‚ö° LongCut</h4>
                        <p>Workspace interactivo con chat sobre el video</p>
                        <a href="https://longcut.ai" target="_blank" class="btn btn-sm">Visitar</a>
                    </div>
                    <div class="step-section">
                        <h4>üéß NotebookLM</h4>
                        <p>Podcasts, res√∫menes y mapas mentales</p>
                        <a href="https://notebooklm.google.com" target="_blank" class="btn btn-sm">Visitar</a>
                    </div>
                </div>
            </div>
        </div>

        <div class="toast" id="toastMsg">‚úÖ Hecho</div>
    </div>

    <script>
        // ============================================================
        // ESTADO GLOBAL (DATOS REALES, NO SIMULADOS)
        // ============================================================
        let estado = {
            categorias: JSON.parse(localStorage.getItem('agora_categorias')) || [
                { id: 1, nombre: 'Programaci√≥n', color: '#3b82f6', enlaces: [] },
                { id: 2, nombre: 'Dise√±o', color: '#10b981', enlaces: [] },
                { id: 3, nombre: 'IA y ML', color: '#8b5cf6', enlaces: [] },
                { id: 4, nombre: 'Pendientes', color: '#f59e0b', enlaces: [] }
            ],
            historial: JSON.parse(localStorage.getItem('agora_historial')) || [],
            bitacora: JSON.parse(localStorage.getItem('agora_bitacora')) || [],
            progreso: JSON.parse(localStorage.getItem('agora_progreso')) || {
                totalVideos: 0,
                totalNotas: 0,
                rachaActual: 0,
                mejorRacha: 0,
                ultimoAcceso: null
            }
        };

        // ============================================================
        // OFICIAL DE SEGURIDAD (SIN APIs, SIN RIESGOS)
        // ============================================================
        const SecurityOfficer = {
            stats: {
                safeDecisions: parseInt(localStorage.getItem('seguridad_safeDecisions')) || 0,
                warnings: parseInt(localStorage.getItem('seguridad_warnings')) || 0,
                risksAvoided: parseInt(localStorage.getItem('seguridad_risksAvoided')) || 0,
                costSavings: parseInt(localStorage.getItem('seguridad_costSavings')) || 0
            },
            logSafeDecision(msg) {
                this.stats.safeDecisions++;
                this.stats.costSavings += 50;
                this.save();
                this.updateUI();
                this.showMessage(`‚úÖ ${msg}`);
            },
            logWarning(msg) {
                this.stats.warnings++;
                this.save();
                this.updateUI();
                this.showMessage(`‚ö†Ô∏è ${msg}`);
            },
            logRiskAvoided(msg) {
                this.stats.risksAvoided++;
                this.stats.costSavings += 200;
                this.save();
                this.updateUI();
                this.showMessage(`üõ°Ô∏è ${msg}`);
            },
            showMessage(msg) {
                document.getElementById('securityMessage').innerHTML = msg;
            },
            save() {
                localStorage.setItem('seguridad_safeDecisions', this.stats.safeDecisions);
                localStorage.setItem('seguridad_warnings', this.stats.warnings);
                localStorage.setItem('seguridad_risksAvoided', this.stats.risksAvoided);
                localStorage.setItem('seguridad_costSavings', this.stats.costSavings);
            },
            updateUI() {
                document.getElementById('safeDecisions').innerText = this.stats.safeDecisions;
                document.getElementById('warnings').innerText = this.stats.warnings;
                document.getElementById('risksAvoided').innerText = this.stats.risksAvoided;
                document.getElementById('costSavings').innerText = this.stats.costSavings;
            }
        };
        SecurityOfficer.updateUI();

        // ============================================================
        // FUNCIONES DE PERSISTENCIA
        // ============================================================
        function guardarTodo() {
            localStorage.setItem('agora_categorias', JSON.stringify(estado.categorias));
            localStorage.setItem('agora_historial', JSON.stringify(estado.historial));
            localStorage.setItem('agora_bitacora', JSON.stringify(estado.bitacora));
            localStorage.setItem('agora_progreso', JSON.stringify(estado.progreso));
            actualizarProgreso();
        }

        // ============================================================
        // ANALIZADOR DE VIDEOS (SIN API, BASADO EN TEXTO)
        // ============================================================
        function analizarVideo(titulo) {
            const texto = titulo.toLowerCase();
            
            // Detectar tema
            let tema = 'General';
            if (texto.includes('react') || texto.includes('javascript') || texto.includes('python') || texto.includes('programaci√≥n')) {
                tema = 'Programaci√≥n';
            } else if (texto.includes('dise√±o') || texto.includes('figma') || texto.includes('ux') || texto.includes('ui')) {
                tema = 'Dise√±o';
            } else if (texto.includes('ia') || texto.includes('inteligencia') || texto.includes('machine learning') || texto.includes('ml')) {
                tema = 'IA y ML';
            }

            // Detectar nivel
            let nivel = 'Intermedio';
            if (texto.includes('principiante') || texto.includes('b√°sico') || texto.includes('desde cero')) {
                nivel = 'Principiante';
            } else if (texto.includes('avanzado') || texto.includes('experto') || texto.includes('profesional')) {
                nivel = 'Avanzado';
            }

            // Generar etiquetas
            let etiquetas = [];
            if (texto.includes('react')) etiquetas.push('#react');
            if (texto.includes('javascript')) etiquetas.push('#javascript');
            if (texto.includes('python')) etiquetas.push('#python');
            if (texto.includes('dise√±o')) etiquetas.push('#dise√±o');
            if (texto.includes('figma')) etiquetas.push('#figma');
            if (etiquetas.length === 0) etiquetas.push('#aprendizaje');

            return { tema, nivel, etiquetas };
        }

        // ============================================================
        // RECOMENDADOR DE HERRAMIENTAS
        // ============================================================
        function recomendarHerramientas(tema, nivel) {
            let principal = '';
            let alternativa = '';
            let urlPrincipal = '';

            if (tema === 'Programaci√≥n') {
                principal = 'LongCut (workspace interactivo con chat)';
                urlPrincipal = 'https://longcut.ai';
                alternativa = 'Miyagi Labs para ejercicios pr√°cticos';
            } else if (tema === 'Dise√±o') {
                principal = 'Ainee (notas, mapas, flashcards)';
                urlPrincipal = 'https://ainee.com';
                alternativa = 'NotebookLM para podcast';
            } else if (tema === 'IA y ML') {
                principal = 'NotebookLM (res√∫menes y podcast)';
                urlPrincipal = 'https://notebooklm.google.com';
                alternativa = 'Miyagi Labs para cursos estructurados';
            } else {
                principal = 'Miyagi Labs (cursos completos)';
                urlPrincipal = 'https://miyagilabs.ai';
                alternativa = 'LongCut para workspace interactivo';
            }

            return { principal, alternativa, urlPrincipal };
        }

        // ============================================================
        // GENERADOR DE GU√çAS
        // ============================================================
        function generarGuia(herramienta, videoId) {
            let pasos = [];
            
            if (herramienta.includes('LongCut')) {
                pasos = [
                    '1. Haz clic en "Abrir herramienta"',
                    '2. En LongCut, pega el mismo link del video',
                    '3. Usa el chat para preguntar: "expl√≠came los conceptos clave"',
                    '4. Guarda las respuestas en tu workspace',
                    '5. Exporta tus notas cuando termines'
                ];
            } else if (herramienta.includes('Ainee')) {
                pasos = [
                    '1. Abre Ainee con el bot√≥n de abajo',
                    '2. Pega el link del video',
                    '3. Espera a que genere notas, mapas y flashcards',
                    '4. Revisa el material y guarda lo que te sirva',
                    '5. Practica con los quizzes generados'
                ];
            } else if (herramienta.includes('NotebookLM')) {
                pasos = [
                    '1. Ve a NotebookLM',
                    '2. Crea un nuevo notebook',
                    '3. A√±ade fuente: "YouTube" y pega el link',
                    '4. Escucha el podcast generado',
                    '5. Revisa el resumen y el mapa mental'
                ];
            } else {
                pasos = [
                    '1. Abre Miyagi Labs',
                    '2. Pega el link del video',
                    '3. Completa los quizzes generados',
                    '4. Revisa el feedback de la IA',
                    '5. Guarda tu progreso'
                ];
            }

            return pasos;
        }

        // ============================================================
        // MANEJADOR DE √ÅGORA¬∑VIDEO
        // ============================================================
        document.getElementById('analizarVideoBtn').addEventListener('click', () => {
            const url = document.getElementById('youtubeUrl').value;
            if (!url) {
                alert('Pega un enlace de YouTube');
                return;
            }

            // Extraer ID del video
            let videoId = '';
            const regExp = /^.*(youtu.be\/|v\/|u\/\w\/|embed\/|watch\?v=|\&v=)([^#\&\?]*).*/;
            const match = url.match(regExp);
            if (match && match[2].length === 11) {
                videoId = match[2];
            } else {
                alert('URL no v√°lida');
                return;
            }

            // Simular t√≠tulo (en producci√≥n podr√≠as pedirlo al usuario)
            const tituloSimulado = prompt('¬øCu√°l es el t√≠tulo del video? (para an√°lisis)', 'Aprende React en 1 hora');
            if (!tituloSimulado) return;

            const analisis = analizarVideo(tituloSimulado);
            const recomendacion = recomendarHerramientas(analisis.tema, analisis.nivel);
            const guia = generarGuia(recomendacion.principal, videoId);

            // Mostrar resultados
            document.getElementById('videoTitulo').innerText = tituloSimulado;
            document.getElementById('videoTema').innerText = analisis.tema;
            document.getElementById('videoNivel').innerText = analisis.nivel;
            document.getElementById('videoEtiquetas').innerText = analisis.etiquetas.join(' ¬∑ ');
            
            document.getElementById('recomendacionPrincipal').innerHTML = `<strong>${recomendacion.principal}</strong>`;
            document.getElementById('recomendacionAlternativa').innerHTML = `<small>${recomendacion.alternativa}</small>`;
            
            let guiaHtml = '<ol>';
            guia.forEach(paso => { guiaHtml += `<li>${paso}</li>`; });
            guiaHtml += '</ol>';
            document.getElementById('guiaPasos').innerHTML = guiaHtml;

            document.getElementById('abrirRecomendacionBtn').onclick = () => {
                window.open(recomendacion.urlPrincipal, '_blank');
                SecurityOfficer.logSafeDecision('Usuario abri√≥ herramienta recomendada');
            };

            document.getElementById('guardarProgresoBtn').onclick = () => {
                // Guardar en historial
                const entradaHistorial = {
                    id: Date.now(),
                    fecha: new Date().toISOString().split('T')[0],
                    hora: new Date().toLocaleTimeString(),
                    titulo: tituloSimulado,
                    videoId: videoId,
                    herramienta: recomendacion.principal,
                    tema: analisis.tema,
                    etiquetas: analisis.etiquetas,
                    completado: false
                };
                estado.historial.unshift(entradaHistorial);
                
                // Actualizar progreso
                estado.progreso.totalVideos++;
                const hoy = new Date().toDateString();
                if (estado.progreso.ultimoAcceso === hoy) {
                    // Ya registr√≥ hoy
                } else if (estado.progreso.ultimoAcceso === new Date(Date.now() - 86400000).toDateString()) {
                    estado.progreso.rachaActual++;
                    if (estado.progreso.rachaActual > estado.progreso.mejorRacha) {
                        estado.progreso.mejorRacha = estado.progreso.rachaActual;
                    }
                } else {
                    estado.progreso.rachaActual = 1;
                }
                estado.progreso.ultimoAcceso = hoy;

                guardarTodo();
                SecurityOfficer.logSafeDecision('Progreso guardado correctamente');
                toast('‚úÖ Progreso guardado');
            };

            document.getElementById('analisisResultado').style.display = 'block';
            SecurityOfficer.logSafeDecision('Video analizado correctamente');
        });

        // ============================================================
        // CATEGOR√çAS (CRUD COMPLETO)
        // ============================================================
        function renderCategorias() {
            const container = document.getElementById('categoriasContainer');
            let html = '';

            estado.categorias.forEach(cat => {
                html += `
                    <div class="categoria-container">
                        <div class="categoria-header" onclick="toggleCategoria(${cat.id})">
                            <h4><i class="fas fa-folder" style="color: ${cat.color};"></i> ${cat.nombre} (${cat.enlaces.length})</h4>
                            <div class="fila-acciones">
                                <i class="fas fa-edit" onclick="editarCategoria(${cat.id}); event.stopPropagation();"></i>
                                <i class="fas fa-trash" onclick="eliminarCategoria(${cat.id}); event.stopPropagation();"></i>
                                <i class="fas fa-chevron-down"></i>
                            </div>
                        </div>
                        <div class="categoria-content" id="cat-${cat.id}" style="display: none;">
                            <button class="btn btn-sm btn-primary" onclick="nuevoEnlace(${cat.id})">+ A√±adir enlace</button>
                            ${cat.enlaces.map(enlace => `
                                <div class="enlace-item">
                                    <div>
                                        <strong>${enlace.titulo}</strong><br>
                                        <small>${enlace.fecha} ¬∑ ${enlace.herramienta}</small>
                                    </div>
                                    <div class="fila-acciones">
                                        <i class="fas fa-check-circle" style="color: var(--success);" onclick="marcarCompletado(${cat.id}, ${enlace.id})"></i>
                                        <i class="fas fa-trash" onclick="eliminarEnlace(${cat.id}, ${enlace.id})"></i>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                `;
            });

            container.innerHTML = html;
        }

        window.toggleCategoria = (id) => {
            const elem = document.getElementById(`cat-${id}`);
            if (elem.style.display === 'none') {
                elem.style.display = 'block';
            } else {
                elem.style.display = 'none';
            }
        };

        window.editarCategoria = (id) => {
            const cat = estado.categorias.find(c => c.id === id);
            const nuevoNombre = prompt('Nuevo nombre', cat.nombre);
            if (nuevoNombre) {
                cat.nombre = nuevoNombre;
                guardarTodo();
                renderCategorias();
                SecurityOfficer.logSafeDecision('Categor√≠a editada');
            }
        };

        window.eliminarCategoria = (id) => {
            if (confirm('¬øEliminar categor√≠a? Los enlaces se perder√°n')) {
                estado.categorias = estado.categorias.filter(c => c.id !== id);
                guardarTodo();
                renderCategorias();
                SecurityOfficer.logSafeDecision('Categor√≠a eliminada');
            }
        };

        window.nuevoEnlace = (catId) => {
            const titulo = prompt('T√≠tulo del video');
            if (!titulo) return;
            
            const cat = estado.categorias.find(c => c.id === catId);
            cat.enlaces.push({
                id: Date.now(),
                titulo: titulo,
                fecha: new Date().toLocaleDateString(),
                herramienta: 'Pendiente',
                completado: false
            });
            
            guardarTodo();
            renderCategorias();
            SecurityOfficer.logSafeDecision('Enlace a√±adido a categor√≠a');
        };

        window.eliminarEnlace = (catId, enlaceId) => {
            const cat = estado.categorias.find(c => c.id === catId);
            cat.enlaces = cat.enlaces.filter(e => e.id !== enlaceId);
            guardarTodo();
            renderCategorias();
            SecurityOfficer.logSafeDecision('Enlace eliminado');
        };

        window.marcarCompletado = (catId, enlaceId) => {
            const cat = estado.categorias.find(c => c.id === catId);
            const enlace = cat.enlaces.find(e => e.id === enlaceId);
            enlace.completado = !enlace.completado;
            guardarTodo();
            renderCategorias();
            SecurityOfficer.logSafeDecision('Progreso actualizado');
        };

        document.getElementById('nuevaCategoriaBtn').addEventListener('click', () => {
            const nombre = prompt('Nombre de la categor√≠a');
            if (nombre) {
                estado.categorias.push({
                    id: Date.now(),
                    nombre: nombre,
                    color: '#b68b40',
                    enlaces: []
                });
                guardarTodo();
                renderCategorias();
                SecurityOfficer.logSafeDecision('Nueva categor√≠a creada');
            }
        });

        // ============================================================
        // HISTORIAL
        // ============================================================
        function renderHistorial() {
            const container = document.getElementById('historialContainer');
            if (estado.historial.length === 0) {
                container.innerHTML = '<p class="step-section">No hay historial a√∫n. Analiza un video en √Ågora¬∑Video.</p>';
                return;
            }

            let html = '';
            const historialPorFecha = {};
            estado.historial.forEach(entry => {
                if (!historialPorFecha[entry.fecha]) {
                    historialPorFecha[entry.fecha] = [];
                }
                historialPorFecha[entry.fecha].push(entry);
            });

            Object.keys(historialPorFecha).sort((a,b) => new Date(b) - new Date(a)).forEach(fecha => {
                html += `<div class="historial-dia">`;
                html += `<div class="historial-fecha">üìÖ ${fecha}</div>`;
                
                historialPorFecha[fecha].forEach(entry => {
                    html += `
                        <div class="enlace-item">
                            <div>
                                <strong>${entry.titulo}</strong><br>
                                <small>${entry.hora} ¬∑ ${entry.herramienta} ¬∑ ${entry.tema}</small>
                            </div>
                            <div class="fila-acciones">
                                <i class="fas fa-book-open" onclick="a√±adirABitacora(${entry.id})" title="A√±adir a bit√°cora"></i>
                                <i class="fas fa-folder-plus" onclick="a√±adirACategoria(${entry.id})" title="A√±adir a categor√≠a"></i>
                            </div>
                        </div>
                    `;
                });
                
                html += `</div>`;
            });

            container.innerHTML = html;
        }

        window.a√±adirABitacora = (id) => {
            const entry = estado.historial.find(e => e.id === id);
            if (!entry) return;

            const aprendido = prompt('¬øQu√© aprendiste?');
            if (!aprendido) return;

            estado.bitacora.unshift({
                id: Date.now(),
                fecha: new Date().toLocaleDateString(),
                titulo: entry.titulo,
                videoId: entry.videoId,
                aprendido: aprendido,
                dificultades: prompt('¬øQu√© dificultades tuviste?', 'Ninguna'),
                etiquetas: entry.etiquetas
            });

            estado.progreso.totalNotas++;
            guardarTodo();
            renderBitacora();
            SecurityOfficer.logSafeDecision('Entrada a√±adida a bit√°cora');
            toast('‚úÖ A√±adido a bit√°cora');
        };

        window.a√±adirACategoria = (id) => {
            const entry = estado.historial.find(e => e.id === id);
            if (!entry) return;

            const catIndex = prompt('ID de categor√≠a (1-4):\n1: Programaci√≥n\n2: Dise√±o\n3: IA\n4: Pendientes');
            if (!catIndex) return;

            const cat = estado.categorias[parseInt(catIndex) - 1];
            if (cat) {
                cat.enlaces.push({
                    id: Date.now(),
                    titulo: entry.titulo,
                    fecha: entry.fecha,
                    herramienta: entry.herramienta,
                    completado: false
                });
                guardarTodo();
                renderCategorias();
                SecurityOfficer.logSafeDecision('Video a√±adido a categor√≠a');
                toast('‚úÖ A√±adido a categor√≠a');
            }
        };

        // ============================================================
        // BIT√ÅCORA
        // ============================================================
        function renderBitacora() {
            const container = document.getElementById('bitacoraContainer');
            if (estado.bitacora.length === 0) {
                container.innerHTML = '<p class="step-section">No hay entradas en la bit√°cora.</p>';
                return;
            }

            let html = '';
            estado.bitacora.forEach(entry => {
                html += `
                    <div class="bitacora-entrada">
                        <div style="display: flex; justify-content: space-between;">
                            <strong>${entry.titulo}</strong>
                            <small>${entry.fecha}</small>
                        </div>
                        <p><strong>üìù Aprendido:</strong> ${entry.aprendido}</p>
                        <p><strong>‚ö†Ô∏è Dificultades:</strong> ${entry.dificultades || 'Ninguna'}</p>
                        <div class="bitacora-tags">
                            ${entry.etiquetas ? entry.etiquetas.map(e => `<span>${e}</span>`).join('') : ''}
                        </div>
                        <div class="fila-acciones" style="margin-top: 0.5rem;">
                            <i class="fas fa-edit" onclick="editarBitacora(${entry.id})"></i>
                            <i class="fas fa-trash" onclick="eliminarBitacora(${entry.id})"></i>
                        </div>
                    </div>
                `;
            });

            container.innerHTML = html;
        }

        window.editarBitacora = (id) => {
            const entry = estado.bitacora.find(e => e.id === id);
            const nuevoAprendido = prompt('¬øQu√© aprendiste?', entry.aprendido);
            if (nuevoAprendido) {
                entry.aprendido = nuevoAprendido;
                guardarTodo();
                renderBitacora();
                SecurityOfficer.logSafeDecision('Entrada editada');
            }
        };

        window.eliminarBitacora = (id) => {
            if (confirm('¬øEliminar entrada?')) {
                estado.bitacora = estado.bitacora.filter(e => e.id !== id);
                estado.progreso.totalNotas--;
                guardarTodo();
                renderBitacora();
                SecurityOfficer.logSafeDecision('Entrada eliminada');
            }
        };

        document.getElementById('nuevaEntradaBitacoraBtn').addEventListener('click', () => {
            const titulo = prompt('T√≠tulo del video');
            if (!titulo) return;
            const aprendido = prompt('¬øQu√© aprendiste?');
            if (!aprendido) return;

            estado.bitacora.unshift({
                id: Date.now(),
                fecha: new Date().toLocaleDateString(),
                titulo: titulo,
                aprendido: aprendido,
                dificultades: prompt('¬øQu√© dificultades tuviste?', 'Ninguna'),
                etiquetas: []
            });

            estado.progreso.totalNotas++;
            guardarTodo();
            renderBitacora();
            SecurityOfficer.logSafeDecision('Nueva entrada en bit√°cora');
        });

        // ============================================================
        // PROGRESO
        // ============================================================
        function actualizarProgreso() {
            document.getElementById('totalVideos').innerText = estado.progreso.totalVideos;
            document.getElementById('totalNotas').innerText = estado.progreso.totalNotas;
            document.getElementById('rachaActual').innerText = estado.progreso.rachaActual;
            document.getElementById('mejorRacha').innerText = estado.progreso.mejorRacha;

            // Mostrar detalle de actividad reciente
            const detalle = document.getElementById('progresoDetalle');
            if (estado.historial.length > 0) {
                const ultimos = estado.historial.slice(0, 5);
                detalle.innerHTML = `
                    <h4>Actividad reciente</h4>
                    ${ultimos.map(v => `
                        <div style="display: flex; justify-content: space-between; padding: 0.5rem 0; border-bottom: 1px dashed var(--border);">
                            <span>${v.titulo.substring(0, 30)}...</span>
                            <small>${v.fecha}</small>
                        </div>
                    `).join('')}
                `;
            }
        }

        // ============================================================
        // UTILIDADES
        // ============================================================
        function toast(msg) {
            const t = document.getElementById('toastMsg');
            t.style.display = 'block';
            t.innerText = msg;
            setTimeout(() => t.style.display = 'none', 2000);
        }

        // ============================================================
        // NAVEGACI√ìN Y MODO OSCURO
        // ============================================================
        document.getElementById('toggleModo').addEventListener('click', () => {
            document.body.classList.toggle('dark');
        });

        document.querySelectorAll('#menuNav button').forEach(b => {
            b.addEventListener('click', (e) => {
                document.querySelectorAll('#menuNav button').forEach(bb => bb.classList.remove('active'));
                b.classList.add('active');
                document.querySelectorAll('.tab-panel').forEach(p => p.classList.remove('active'));
                document.getElementById(b.dataset.tab).classList.add('active');
                
                // Renderizar seg√∫n pesta√±a
                if (b.dataset.tab === 'tab2') renderCategorias();
                if (b.dataset.tab === 'tab3') renderHistorial();
                if (b.dataset.tab === 'tab4') renderBitacora();
                if (b.dataset.tab === 'tab5') actualizarProgreso();
            });
        });

        // Inicializar
        SecurityOfficer.updateUI();
        renderCategorias();
        renderHistorial();
        renderBitacora();
        actualizarProgreso();
    </script>
</body>
</html>
